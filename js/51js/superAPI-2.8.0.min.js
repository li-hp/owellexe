(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():e.io=t()})(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n=i(e),o=n.source,d=n.id,p=n.path,u=c[d]&&p in c[d].nsps,l=t.forceNew||t["force new connection"]||!1===t.multiplex||u;return l?(s("ignoring socket cache for %s",o),r=a(o,t)):(c[d]||(s("new io instance for %s",o),c[d]=a(o,t)),r=c[d]),n.query&&!t.query&&(t.query=n.query),r.socket(n.path,t)}var i=r(1),o=r(7),a=r(15),s=r(3)("socket.io-client");e.exports=t=n;var c=t.managers={};t.protocol=o.protocol,t.connect=n,t.Manager=r(15),t.Socket=r(39)},function(e,t,r){function n(e,t){var r=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),o("parse %s",e),r=i(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var n=-1!==r.host.indexOf(":"),a=n?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port,r.href=r.protocol+"://"+a+(t&&t.port===r.port?"":":"+r.port),r}var i=r(2),o=r(3)("socket.io-client:url");e.exports=n},function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=r.exec(e||""),s={},c=14;c--;)s[n[c]]=a[c]||"";return-1!=i&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},function(e,t,r){(function(n){"use strict";function i(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))}),t.splice(i,0,r)}}function a(){var e;return"object"===("undefined"==typeof console?"undefined":p(console))&&console.log&&(e=console).log.apply(e,arguments)}function s(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}}function c(){var e=void 0;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}function d(){try{return localStorage}catch(e){}}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.log=a,t.formatArgs=o,t.save=s,t.load=c,t.useColors=i,t.storage=d(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(5)(t);var u=e.exports.formatters;u.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(t,r(4))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(p===setTimeout)return setTimeout(e,0);if((p===r||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function o(e){if(u===clearTimeout)return clearTimeout(e);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function a(){m&&f&&(m=!1,f.length?h=f.concat(h):v=-1,h.length&&s())}function s(){if(!m){var e=i(a);m=!0;for(var t=h.length;t;){for(f=h,h=[];++v<t;)f&&f[v].run();v=-1,t=h.length}f=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var p,u,l=e.exports={};(function(){try{p="function"==typeof setTimeout?setTimeout:r}catch(e){p=r}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(e){u=n}})();var f,h=[],m=!1,v=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new c(e,t)),1!==h.length||m||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=d,l.addListener=d,l.once=d,l.off=d,l.removeListener=d,l.removeAllListeners=d,l.emit=d,l.prependListener=d,l.prependOnceListener=d,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function i(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){function r(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];if(r.enabled){var a=r,s=Number(new Date),c=s-(n||s);a.diff=c,a.prev=n,a.curr=s,n=s,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var d=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,r){if("%%"===e)return e;d++;var n=i.formatters[r];if("function"==typeof n){var o=t[d];e=n.call(a,o),t.splice(d,1),d--}return e}),i.formatArgs.call(a,t);var p=a.log||i.log;p.apply(a,t)}}var n=void 0;return r.namespace=e,r.enabled=i.enabled(e),r.useColors=i.useColors(),r.color=t(e),r.destroy=o,r.extend=a,"function"==typeof i.init&&i.init(r),i.instances.push(r),r}function o(){var e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function a(e,t){var r=i(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function s(e){i.save(e),i.names=[],i.skips=[];var t=void 0,r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&(e=r[t].replace(/\*/g,".*?"),"-"===e[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){var o=i.instances[t];o.enabled=i.enabled(o.namespace)}}function c(){var e=[].concat(n(i.names.map(p)),n(i.skips.map(p).map(function(e){return"-"+e}))).join(",");return i.enable(""),e}function d(e){if("*"===e[e.length-1])return!0;var t=void 0,r=void 0;for(t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(e))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(e))return!0;return!1}function p(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function u(e){return e instanceof Error?e.stack||e.message:e}return i.debug=i,i.default=i,i.coerce=u,i.disable=c,i.enable=s,i.enabled=d,i.humanize=r(6),Object.keys(e).forEach(function(t){i[t]=e[t]}),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}e.exports=i},function(e,t){function r(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*u;case"weeks":case"week":case"w":return r*p;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function n(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=c?Math.round(e/c)+"h":t>=s?Math.round(e/s)+"m":t>=a?Math.round(e/a)+"s":e+"ms"}function i(e){var t=Math.abs(e);return t>=d?o(e,t,d,"day"):t>=c?o(e,t,c,"hour"):t>=s?o(e,t,s,"minute"):t>=a?o(e,t,a,"second"):e+" ms"}function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}var a=1e3,s=60*a,c=60*s,d=24*c,p=7*d,u=365.25*d;e.exports=function(e,t){t=t||{};var o=typeof e;if("string"===o&&e.length>0)return r(e);if("number"===o&&isFinite(e))return t.long?i(e):n(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(){}function i(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var n=o(e.data);if(!1===n)return g;r+=n}return l("encoded %j as %s",e,r),r}function o(e){try{return JSON.stringify(e)}catch(e){return!1}}function a(e,t){function r(e){var r=h.deconstructPacket(e),n=i(r.packet),o=r.buffers;o.unshift(n),t(o)}h.removeBlobs(e,r)}function s(){this.reconstructor=null}function c(e){var r=0,n={type:Number(e.charAt(0))};if(null==t.types[n.type])return u("unknown packet type "+n.type);if(t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(r+1))for(n.nsp="";++r;){var o=e.charAt(r);if(","===o)break;if(n.nsp+=o,r===e.length)break}else n.nsp="/";var a=e.charAt(r+1);if(""!==a&&Number(a)==a){for(n.id="";++r;){if(o=e.charAt(r),null==o||Number(o)!=o){--r;break}if(n.id+=e.charAt(r),r===e.length)break}n.id=Number(n.id)}if(e.charAt(++r)){var s=d(e.substr(r)),c=!1!==s&&(n.type===t.ERROR||m(s));if(!c)return u("invalid payload");n.data=s}return l("decoded %s as %j",e,n),n}function d(e){try{return JSON.parse(e)}catch(e){return!1}}function p(e){this.reconPack=e,this.buffers=[]}function u(e){return{type:t.ERROR,data:"parser error: "+e}}var l=r(8)("socket.io-parser"),f=r(11),h=r(12),m=r(13),v=r(14);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=n,t.Decoder=s;var g=t.ERROR+'"encode error"';n.prototype.encode=function(e,r){if(l("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)a(e,r);else{var n=i(e);r([n])}},f(s.prototype),s.prototype.add=function(e){var r;if("string"==typeof e)r=c(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new p(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!v(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");r=this.reconstructor.takeBinaryData(e),r&&(this.reconstructor=null,this.emit("decoded",r))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},p.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=h.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},p.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,r){(function(n){"use strict";function i(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),r){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n)}}function a(){return"object"===("undefined"==typeof console?"undefined":p(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function c(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}function d(){try{return window.localStorage}catch(e){}}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t=e.exports=r(9),t.log=a,t.formatArgs=o,t.save=s,t.load=c,t.useColors=i,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:d(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(c())}).call(t,r(4))},function(e,t,r){"use strict";function n(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}function i(e){function r(){if(r.enabled){var e=r,n=+new Date,o=n-(i||n);e.diff=o,e.prev=i,e.curr=n,i=n;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var i=t.formatters[n];if("function"==typeof i){var o=a[c];r=i.call(e,o),a.splice(c,1),c--}return r}),t.formatArgs.call(e,a);var d=r.log||t.log||console.log.bind(console);d.apply(e,a)}}var i;return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=n(e),r.destroy=o,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function a(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&(e=n[r].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var o=t.instances[r];o.enabled=t.enabled(o.namespace)}}function s(){t.enable("")}function c(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1}function d(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i.debug=i.default=i,t.coerce=d,t.disable=s,t.enable=a,t.enabled=c,t.humanize=r(10),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function r(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*p;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function n(e){return e>=d?Math.round(e/d)+"d":e>=c?Math.round(e/c)+"h":e>=s?Math.round(e/s)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function i(e){return o(e,d,"day")||o(e,c,"hour")||o(e,s,"minute")||o(e,a,"second")||e+" ms"}function o(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var a=1e3,s=60*a,c=60*s,d=24*c,p=365.25*d;e.exports=function(e,t){t=t||{};var o=typeof e;if("string"===o&&e.length>0)return r(e);if("number"===o&&!1===isNaN(e))return t.long?i(e):n(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if(r=n[i],r===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){function n(e,t){if(!e)return e;if(a(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(o(e)){for(var i=new Array(e.length),s=0;s<e.length;s++)i[s]=n(e[s],t);return i}if("object"==typeof e&&!(e instanceof Date)){for(var c in i={},e)i[c]=n(e[c],t);return i}return e}function i(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(o(e))for(var r=0;r<e.length;r++)e[r]=i(e[r],t);else if("object"==typeof e)for(var n in e)e[n]=i(e[n],t);return e}var o=r(13),a=r(14),s=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),d="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);t.deconstructPacket=function(e){var t=[],r=e.data,i=e;return i.data=n(r,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=i(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){function r(e,s,p){if(!e)return e;if(c&&e instanceof Blob||d&&e instanceof File){n++;var u=new FileReader;u.onload=function(){p?p[s]=this.result:i=this.result,--n||t(i)},u.readAsArrayBuffer(e)}else if(o(e))for(var l=0;l<e.length;l++)r(e[l],l,e);else if("object"==typeof e&&!a(e))for(var f in e)r(e[f],f,e)}var n=0,i=e;r(i),n||t(i)}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){function r(e){return n&&Buffer.isBuffer(e)||i&&(e instanceof ArrayBuffer||o(e))}e.exports=r;var n="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,i="function"==typeof ArrayBuffer,o=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}},function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i=r(16),o=r(39),a=r(11),s=r(7),c=r(41),d=r(42),p=r(3)("socket.io-client:manager"),u=r(38),l=r(43),f=Object.prototype.hasOwnProperty;e.exports=n,n.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},n.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},n.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(n.prototype),n.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},n.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},n.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},n.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},n.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},n.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},n.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},n.prototype.open=n.prototype.connect=function(e,t){if(p("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;p("opening %s",this.uri),this.engine=i(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var o=c(r,"open",function(){n.onopen(),e&&e()}),a=c(r,"error",function(t){if(p("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;p("connect attempt will timeout after %d",s);var d=setTimeout(function(){p("connect attempt timed out after %d",s),o.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(o),this.subs.push(a),this},n.prototype.onopen=function(){p("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},n.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},n.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},n.prototype.ondata=function(e){this.decoder.add(e)},n.prototype.ondecoded=function(e){this.emit("packet",e)},n.prototype.onerror=function(e){p("error",e),this.emitAll("error",e)},n.prototype.socket=function(e,t){function r(){~u(i.connecting,n)||i.connecting.push(n)}var n=this.nsps[e];if(!n){n=new o(this,e,t),this.nsps[e]=n;var i=this;n.on("connecting",r),n.on("connect",function(){n.id=i.generateId(e)}),this.autoConnect&&r()}return n},n.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},n.prototype.packet=function(e){p("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},n.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},n.prototype.cleanup=function(){p("cleanup");for(var e=this.subs.length,t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},n.prototype.close=n.prototype.disconnect=function(){p("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},n.prototype.onclose=function(e){p("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},n.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)p("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();p("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(p("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(p("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(p("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},n.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,r){e.exports=r(17),e.exports.parser=r(24)},function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=p(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=p(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function i(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var o=r(18),a=r(11),s=r(3)("engine.io-client:socket"),c=r(38),d=r(24),p=r(2),u=r(32);e.exports=n,n.priorWebsocketSuccess=!1,a(n.prototype),n.protocol=d.protocol,n.Socket=n,n.Transport=r(23),n.transports=r(18),n.parser=r(24),n.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=i(this.query);t.EIO=d.protocol,t.transport=e;var r=this.transportOptions[e]||{};this.id&&(t.sid=this.id);var n=new o[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative});return n},n.prototype.open=function(){var e
;if(this.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},n.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},n.prototype.probe=function(e){function t(){if(l.onlyBinaryUpgrades){var t=!this.supportsBinary&&l.transport.supportsBinary;u=u||t}u||(s('probe transport "%s" opened',e),p.send([{type:"ping",data:"probe"}]),p.once("packet",function(t){if(!u)if("pong"===t.type&&"probe"===t.data){if(s('probe transport "%s" pong',e),l.upgrading=!0,l.emit("upgrading",p),!p)return;n.priorWebsocketSuccess="websocket"===p.name,s('pausing current transport "%s"',l.transport.name),l.transport.pause(function(){u||"closed"!==l.readyState&&(s("changing transport and sending upgrade packet"),d(),l.setTransport(p),p.send([{type:"upgrade"}]),l.emit("upgrade",p),p=null,l.upgrading=!1,l.flush())})}else{s('probe transport "%s" failed',e);var r=new Error("probe error");r.transport=p.name,l.emit("upgradeError",r)}}))}function r(){u||(u=!0,d(),p.close(),p=null)}function i(t){var n=new Error("probe error: "+t);n.transport=p.name,r(),s('probe transport "%s" failed because of error: %s',e,t),l.emit("upgradeError",n)}function o(){i("transport closed")}function a(){i("socket closed")}function c(e){p&&e.name!==p.name&&(s('"%s" works - aborting "%s"',e.name,p.name),r())}function d(){p.removeListener("open",t),p.removeListener("error",i),p.removeListener("close",o),l.removeListener("close",a),l.removeListener("upgrading",c)}s('probing transport "%s"',e);var p=this.createTransport(e,{probe:1}),u=!1,l=this;n.priorWebsocketSuccess=!1,p.once("open",t),p.once("error",i),p.once("close",o),this.once("close",a),this.once("upgrading",c),p.open()},n.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},n.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},n.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},n.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},n.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},n.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},n.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},n.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},n.prototype.write=n.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},n.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){r=r||{},r.compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},n.prototype.close=function(){function e(){n.onClose("forced close"),s("socket closing - telling transport to close"),n.transport.close()}function t(){n.removeListener("upgrade",t),n.removeListener("upgradeError",t),e()}function r(){n.once("upgrade",t),n.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}return this},n.prototype.onError=function(e){s("socket error %j",e),n.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},n.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},n.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~c(this.transports,e[r])&&t.push(e[r]);return t}},function(e,t,r){function n(e){var t,r=!1,n=!1,s=!1!==e.jsonp;if("undefined"!=typeof location){var c="https:"===location.protocol,d=location.port;d||(d=c?443:80),r=e.hostname!==location.hostname||d!==e.port,n=e.secure!==c}if(e.xdomain=r,e.xscheme=n,t=new i(e),"open"in t&&!e.forceJSONP)return new o(e);if(!s)throw new Error("JSONP disabled");return new a(e)}var i=r(19),o=r(21),a=r(35),s=r(36);t.polling=n,t.websocket=s},function(e,t,r){var n=r(20);e.exports=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,r){function n(){}function i(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var s=r(19),c=r(22),d=r(11),p=r(33),u=r(3)("engine.io-client:polling-xhr");if(e.exports=i,e.exports.Request=o,p(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=n},i.prototype.doPoll=function(){u("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},d(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new s(e),r=this;try{u("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var n in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.extraHeaders[n])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(r.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout(function(){r.onError("number"==typeof t.status?t.status:0)},0))},u("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}"undefined"!=typeof document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},o.requestsCount=0,o.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",a);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,a,!1)}},function(e,t,r){function n(e){var t=e&&e.forceBase64;l&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=r(23),o=r(32),a=r(24),s=r(33),c=r(34),d=r(3)("engine.io-client:polling");e.exports=n;var p,u,l=(p=r(19),u=new p({xdomain:!1}),null!=u.responseType);s(n,i),n.prototype.name="polling",n.prototype.doOpen=function(){this.poll()},n.prototype.pause=function(e){function t(){d("paused"),r.readyState="paused",e()}var r=this;if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(d("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){d("pre-pause polling complete"),--n||t()})),this.writable||(d("we are currently writing - waiting to pause"),n++,this.once("drain",function(){d("pre-pause writing complete"),--n||t()}))}else t()},n.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},n.prototype.onData=function(e){var t=this;d("polling got data %s",e);var r=function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)};a.decodePayload(e,this.socket.binaryType,r),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},n.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},n.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e);var n=-1!==this.hostname.indexOf(":");return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(e,t,r){function n(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var i=r(24),o=r(11);e.exports=n,o(n.prototype),n.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},n.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},n.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},n.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},n.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},n.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},n.prototype.onPacket=function(e){this.emit("packet",e)},n.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,r){function n(e,r){var n="b"+t.packets[e.type]+e.data.data;return r(n)}function i(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=y[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return n(a.buffer)}function o(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},r,!0,n)},i.readAsArrayBuffer(e.data)}function a(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(g)return o(e,r,n);var i=new Uint8Array(1);i[0]=y[e.type];var a=new S([i.buffer,e.data]);return n(a)}function s(e){try{e=h.decode(e,{strict:!1})}catch(e){return!1}return e}function c(e,t,r){for(var n=new Array(e.length),i=f(e.length,r),o=function(e,r,i){t(r,function(t,r){n[e]=r,i(t,n)})},a=0;a<e.length;a++)o(a,e[a],i)}var d,p=r(25),u=r(26),l=r(27),f=r(28),h=r(29);"undefined"!=typeof ArrayBuffer&&(d=r(30));var m="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),v="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),g=m||v;t.protocol=3;var y=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},C=p(y),b={type:"error",data:"parser error"},S=r(31);t.encodePacket=function(e,t,r,o){"function"==typeof t&&(o=t,t=!1),"function"==typeof r&&(o=r,r=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return i(e,t,o);if(void 0!==S&&s instanceof S)return a(e,t,o);if(s&&s.base64)return n(e,o);var c=y[e.type];return void 0!==e.data&&(c+=r?h.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,r){var n,i="b"+t.packets[e.type];if(void 0!==S&&e.data instanceof S){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];r(i+e)},o.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];n=String.fromCharCode.apply(null,s)}return i+=btoa(n),r(i)},t.decodePacket=function(e,r,n){if(void 0===e)return b;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&(e=s(e),!1===e))return b;var i=e.charAt(0);return Number(i)==i&&C[i]?e.length>1?{type:C[i],data:e.substring(1)}:{type:C[i]}:b}var o=new Uint8Array(e),a=(i=o[0],l(e,1));return S&&"blob"===r&&(a=new S([a])),{type:C[i],data:a}},t.decodeBase64Packet=function(e,t){var r=C[e.charAt(0)];if(!d)return{type:r,data:{base64:!0,data:e.substr(1)}};var n=d.decode(e.substr(1));return"blob"===t&&S&&(n=new S([n])),{type:r,data:n}},t.encodePayload=function(e,r,n){function i(e){return e.length+":"+e}function o(e,n){t.encodePacket(e,!!a&&r,!1,function(e){n(null,i(e))})}"function"==typeof r&&(n=r,r=null);var a=u(e);return r&&a?S&&!g?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n):e.length?void c(e,o,function(e,t){return n(t.join(""))}):n("0:")},t.decodePayload=function(e,r,n){if("string"!=typeof e)return t.decodePayloadAsBinary(e,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===e)return n(b,0,1);for(var o,a,s="",c=0,d=e.length;c<d;c++){var p=e.charAt(c);if(":"===p){if(""===s||s!=(o=Number(s)))return n(b,0,1);if(a=e.substr(c+1,o),s!=a.length)return n(b,0,1);if(a.length){if(i=t.decodePacket(a,r,!1),b.type===i.type&&b.data===i.data)return n(b,0,1);var u=n(i,c+o,d);if(!1===u)return}c+=o,s=""}else s+=p}return""!==s?n(b,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){function n(e,r){t.encodePacket(e,!0,!0,function(e){return r(null,e)})}if(!e.length)return r(new ArrayBuffer(0));c(e,n,function(e,t){var n=t.reduce(function(e,t){var r;return r="string"==typeof t?t.length:t.byteLength,e+r.toString().length+r+2},0),i=new Uint8Array(n),o=0;return t.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),a=0;a<e.length;a++)n[a]=e.charCodeAt(a);r=n.buffer}i[o++]=t?0:1;var s=r.byteLength.toString();for(a=0;a<s.length;a++)i[o++]=parseInt(s[a]);for(i[o++]=255,n=new Uint8Array(r),a=0;a<n.length;a++)i[o++]=n[a]}),r(i.buffer)})},t.encodePayloadAsBlob=function(e,r){function n(e,r){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,t[0]=0}var o=e instanceof ArrayBuffer?e.byteLength:e.size,a=o.toString(),s=new Uint8Array(a.length+1);for(i=0;i<a.length;i++)s[i]=parseInt(a[i]);if(s[a.length]=255,S){var c=new S([t.buffer,s.buffer,e]);r(null,c)}})}c(e,n,function(e,t){return r(new S(t))})},t.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),s=0===a[0],c="",d=1;255!==a[d];d++){if(c.length>310)return n(b,0,1);c+=a[d]}i=l(i,2+c.length),c=parseInt(c);var p=l(i,0,c);if(s)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var u=new Uint8Array(p);for(p="",d=0;d<u.length;d++)p+=String.fromCharCode(u[d])}o.push(p),i=l(i,c)}var f=o.length;o.forEach(function(e,i){n(t.decodePacket(e,r,!0),i,f)})}},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t,r){function n(e){if(!e||"object"!=typeof e)return!1;if(i(e)){for(var t=0,r=e.length;t<r;t++)if(n(e[t]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||a&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return n(e.toJSON(),!0);for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&n(e[o]))return!0;return!1}var i=r(13),o=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);e.exports=n},function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(r-t),a=t,s=0;a<r;a++,s++)o[s]=i[a];return o.buffer}},function(e,t){function r(e,t,r){function i(e,n){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=r):0!==i.count||o||t(null,n)}var o=!1;return r=r||n,i.count=e,0===e?t():i}function n(){}e.exports=r},function(e,t){function r(e){for(var t,r,n=[],i=0,o=e.length;i<o;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(r=e.charCodeAt(i++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--)):n.push(t);return n}function n(e){for(var t,r=e.length,n=-1,i="";++n<r;)t=e[n],t>65535&&(t-=65536,i+=h(t>>>10&1023|55296),t=56320|1023&t),i+=h(t);return i}function i(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function o(e,t){return h(e>>t&63|128)}function a(e,t){if(0==(4294967168&e))return h(e);var r="";return 0==(4294965248&e)?r=h(e>>6&31|192):0==(4294901760&e)?(i(e,t)||(e=65533),r=h(e>>12&15|224),r+=o(e,6)):0==(4292870144&e)&&(r=h(e>>18&7|240),r+=o(e,12),r+=o(e,6)),r+=h(63&e|128),r}function s(e,t){t=t||{};for(var n,i=!1!==t.strict,o=r(e),s=o.length,c=-1,d="";++c<s;)n=o[c],d+=a(n,i);return d}function c(){if(f>=l)throw Error("Invalid byte index");var e=255&u[f];if(f++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(e){var t,r,n,o,a;if(f>l)throw Error("Invalid byte index");if(f==l)return!1;if(t=255&u[f],f++,0==(128&t))return t;if(192==(224&t)){if(r=c(),a=(31&t)<<6|r,a>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&t)){if(r=c(),n=c(),a=(15&t)<<12|r<<6|n,a>=2048)return i(a,e)?a:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(r=c(),n=c(),o=c(),a=(7&t)<<18|r<<12|n<<6|o,a>=65536&&a<=1114111))return a;throw Error("Invalid UTF-8 detected")}function p(e,t){t=t||{};var i=!1!==t.strict;u=r(e),l=u.length,f=0;for(var o,a=[];!1!==(o=d(i));)a.push(o);return n(a)}var u,l,f,h=String.fromCharCode;e.exports={version:"2.1.2",encode:s,decode:p}},function(e,t){(function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,i,o,a,s=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var p=new ArrayBuffer(s),u=new Uint8Array(p);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],i=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],a=r[e.charCodeAt(t+3)],u[d++]=n<<2|i>>4,u[d++]=(15&i)<<4|o>>2,u[d++]=(3&o)<<6|63&a;return p}})()},function(e,t){function r(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e})}function n(e,t){t=t||{};var n=new o;return r(e).forEach(function(e){n.append(e)}),t.type?n.getBlob(t.type):n.getBlob()}function i(e,t){return new Blob(r(e),t||{})}var o=void 0!==o?o:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,a=function(){try{var e=new Blob(["hi"]);return 2===e.size}catch(e){return!1}}(),s=a&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return 2===e.size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;"undefined"!=typeof Blob&&(n.prototype=Blob.prototype,i.prototype=Blob.prototype),e.exports=a?s?Blob:i:c?n:void 0},function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){"use strict";function r(e){var t="";do{t=a[e%s]+t,e=Math.floor(e/s)}while(e>0);return t}function n(e){var t=0;for(p=0;p<e.length;p++)t=t*s+c[e.charAt(p)];return t}function i(){var e=r(+new Date);return e!==o?(d=0,o=e):e+"."+r(d++)}for(var o,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=64,c={},d=0,p=0;p<s;p++)c[a[p]]=p;i.encode=r,i.decode=n,e.exports=i},function(e,t,r){(function(t){function n(){}function i(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function o(e){if(a.call(this,e),this.query=this.query||{},!c){var t=i();c=t.___eio=t.___eio||[]}this.index=c.length;var r=this;c.push(function(e){r.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){r.script&&(r.script.onerror=n)},!1)}var a=r(22),s=r(33);e.exports=o;var c,d=/\n/g,p=/\\n/g;s(o,a),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),a.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t;var n="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype.doWrite=function(e,t){function r(){n(),t()}function n(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){o=document.createElement("iframe"),o.name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,a=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=c,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),n(),e=e.replace(p,"\\\n"),this.area.value=e.replace(d,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&r()}:this.iframe.onload=r}}).call(t,function(){return this}())},function(e,t,r){function n(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=i&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=o),a.call(this,e)}var i,o,a=r(23),s=r(24),c=r(32),d=r(33),p=r(34),u=r(3)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?i=WebSocket:"undefined"!=typeof self&&(i=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{o=r(37)}catch(e){}var l=i||o;e.exports=n,d(n,a),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new l(e,t):new l(e):new l(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},n.prototype.write=function(e){function t(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var n=e.length,i=0,o=n;i<o;i++)(function(e){s.encodePacket(e,r.supportsBinary,function(i){if(!r.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),r.perMessageDeflate){var a="string"==typeof i?Buffer.byteLength(i):i.length;a<r.perMessageDeflate.threshold&&(o.compress=!1)}}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,o)}catch(e){u("websocket closed before onclose event")}--n||t()})})(e[i])},n.prototype.onClose=function(){a.prototype.onClose.call(this)},n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=p()),this.supportsBinary||(e.b64=1),e=c.encode(e),e.length&&(e="?"+e);var n=-1!==this.hostname.indexOf(":");return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e},n.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===n.prototype.name)}},function(e,t){},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,r){function n(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}var i=r(7),o=r(11),a=r(40),s=r(41),c=r(42),d=r(3)("socket.io-client:socket"),p=r(32),u=r(26);e.exports=n;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1
},f=o.prototype.emit;o(n.prototype),n.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",c(this,"onopen")),s(e,"packet",c(this,"onpacket")),s(e,"close",c(this,"onclose"))]}},n.prototype.open=n.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},n.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},n.prototype.emit=function(e){if(l.hasOwnProperty(e))return f.apply(this,arguments),this;var t=a(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?i.BINARY_EVENT:i.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},n.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},n.prototype.onopen=function(){if(d("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?p.encode(this.query):this.query;d("sending connect packet with query %s",e),this.packet({type:i.CONNECT,query:e})}else this.packet({type:i.CONNECT})},n.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},n.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===i.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},n.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},n.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var n=a(arguments);d("sending ack %j",n),t.packet({type:u(n)?i.BINARY_ACK:i.ACK,id:e,data:n})}}},n.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},n.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},n.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},n.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},n.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},n.prototype.close=n.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},n.prototype.compress=function(e){return this.flags.compress=e,this},n.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){function r(e,t){var r=[];t=t||0;for(var n=t||0;n<e.length;n++)r[n-t]=e[n];return r}e.exports=r},function(e,t){function r(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}e.exports=r},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}}])}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.adapter=e()}}(function(){return function(){function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var p=r[a]={exports:{}};t[a][0].call(p.exports,function(e){var r=t[a][1][e];return i(r||e)},p,p.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}return e}()({1:[function(e,t,r){"use strict";var n=e("./adapter_factory.js"),i=(0,n.adapterFactory)({window:window});t.exports=i},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=a.log,i=a.detectBrowser(t),o={browserDetails:i,commonShim:v,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(i.browser){case"chrome":if(!c||!c.shimPeerConnection||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),o;n("adapter.js shimming chrome."),o.browserShim=c,c.shimGetUserMedia(t),c.shimMediaStream(t),c.shimPeerConnection(t),c.shimOnTrack(t),c.shimAddTrackRemoveTrack(t),c.shimGetSendersWithDtmf(t),c.shimGetStats(t),c.shimSenderReceiverGetStats(t),c.fixNegotiationNeeded(t),v.shimRTCIceCandidate(t),v.shimConnectionState(t),v.shimMaxMessageSize(t),v.shimSendThrowTypeError(t),v.removeAllowExtmapMixed(t);break;case"firefox":if(!l||!l.shimPeerConnection||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=l,l.shimGetUserMedia(t),l.shimPeerConnection(t),l.shimOnTrack(t),l.shimRemoveStream(t),l.shimSenderGetStats(t),l.shimReceiverGetStats(t),l.shimRTCDataChannel(t),l.shimAddTransceiver(t),l.shimCreateOffer(t),l.shimCreateAnswer(t),v.shimRTCIceCandidate(t),v.shimConnectionState(t),v.shimMaxMessageSize(t),v.shimSendThrowTypeError(t);break;case"edge":if(!p||!p.shimPeerConnection||!r.shimEdge)return n("MS edge shim is not included in this adapter release."),o;n("adapter.js shimming edge."),o.browserShim=p,p.shimGetUserMedia(t),p.shimGetDisplayMedia(t),p.shimPeerConnection(t),p.shimReplaceTrack(t),v.shimMaxMessageSize(t),v.shimSendThrowTypeError(t);break;case"safari":if(!h||!r.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=h,h.shimRTCIceServerUrls(t),h.shimCreateOfferLegacy(t),h.shimCallbacksAPI(t),h.shimLocalStreamsAPI(t),h.shimRemoteStreamsAPI(t),h.shimTrackEventTransceiver(t),h.shimGetUserMedia(t),v.shimRTCIceCandidate(t),v.shimMaxMessageSize(t),v.shimSendThrowTypeError(t),v.removeAllowExtmapMixed(t);break;default:n("Unsupported browser!")}return o}Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=i;var o=e("./utils"),a=n(o),s=e("./chrome/chrome_shim"),c=n(s),d=e("./edge/edge_shim"),p=n(d),u=e("./firefox/firefox_shim"),l=n(u),f=e("./safari/safari_shim"),h=n(f),m=e("./common_shim"),v=n(m)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function a(e){if("object"!==(void 0===e?"undefined":h(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)y.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function s(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function c(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i(s(a(e)))};return t.apply(this,[c,n])}return new Promise(function(r,n){t.apply(e,[function(e){r(s(a(e)))},n])}).then(i,o)}}}function d(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return y.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),y.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return y.filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,o=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?o=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?o=!0:n=e),e.track===t}),o||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function p(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});if(r)throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}function u(e){function t(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function r(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}if(e.RTCPeerConnection){var n=y.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return p(e);var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}a.apply(this,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[r.id];if(a)a.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(r){var n=e.RTCPeerConnection.prototype[r],o=i({},r,function(){var e=this,r=arguments,i=arguments.length&&"function"==typeof arguments[0];return i?n.apply(this,[function(n){var i=t(e,n);r[0].apply(null,[i])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(r){return t(e,r)})});e.RTCPeerConnection.prototype[r]=o[r]});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=r(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=d.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r=e._pc===this;if(!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(r){var i=t._streams[r].getTracks().find(function(t){return e.track===t});i&&(n=t._streams[r])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function l(e){var t=y.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=i({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function f(e){y.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if("stable"===t.signalingState)return e})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return m.shimGetUserMedia}});var v=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return v.shimGetDisplayMedia}}),r.shimMediaStream=o,r.shimOnTrack=a,r.shimGetSendersWithDtmf=s,r.shimGetStats=c,r.shimSenderReceiverGetStats=d,r.shimAddTrackRemoveTrackWithNative=p,r.shimAddTrackRemoveTrack=u,r.shimPeerConnection=l,r.fixNegotiationNeeded=f;var g=e("../utils.js"),y=n(g)},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";function n(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],5:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){var t=e&&e.navigator;if(t.mediaDevices){var r=s.detectBrowser(e),n=function(e){if("object"!==(void 0===e?"undefined":o(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===o(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var a={};"number"==typeof n.ideal?(a[i("min",r)]=n.ideal,t.optional.push(a),a={},a[i("max",r)]=n.ideal,t.optional.push(a)):(a[i("",r)]=n.ideal,t.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(r.version>=61)return i(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"===o(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===o(e.video)){var s=e.video.facingMode;s=s&&("object"===(void 0===s?"undefined":o(s))?s:{ideal:s});var d=r.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var p=void 0;if("environment"===s.exact||"environment"===s.ideal?p=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(p=["front"]),p)return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var r=t.find(function(e){return p.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&p.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),c("chrome: "+JSON.stringify(e)),i(e)})}e.video=n(e.video)}return c("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},d=function(e,r,n){i(e,function(e){t.webkitGetUserMedia(e,r,function(e){n&&n(a(e))})})};if(t.getUserMedia=d.bind(t),t.mediaDevices.getUserMedia){var p=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e,function(e){return p(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(a(e))})})}}}}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=i;var a=e("../utils.js"),s=n(a),c=s.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":p(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=l.default.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,h.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function a(e){if(e.RTCPeerConnection){var t=h.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=l.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=l.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},o=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=l.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){var c=n(arguments[0]),d=i(c),p=o(arguments[0],c),u=void 0;u=0===d&&0===p?Number.POSITIVE_INFINITY:0===d||0===p?Math.max(d,p):Math.min(d,p);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return u}}),this._sctp=l}return a.apply(this,arguments)}}}function s(e){function t(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=r.apply(this,arguments);return t(e,this),e},h.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}}function c(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}}function d(e){if(e.RTCPeerConnection){var t=h.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}}}}Object.defineProperty(r,"__esModule",{value:!0});var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){
return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=o,r.shimMaxMessageSize=a,r.shimSendThrowTypeError=s,r.shimConnectionState=c,r.removeAllowExtmapMixed=d;var u=e("sdp"),l=i(u),f=e("./utils"),h=n(f)},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){var t=p.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,f.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,u.filterIceServers)(e.iceServers,t.version),p.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function a(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var s=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var c=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return c.shimGetDisplayMedia}}),r.shimPeerConnection=o,r.shimReplaceTrack=a;var d=e("../utils"),p=i(d),u=e("./filtericeservers"),l=e("rtcpeerconnection-shim"),f=n(l)},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&a.deprecated("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof t;return n&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=n?t[0]:t,!!t.length}})}Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=i;var o=e("../utils"),a=n(o)},{"../utils":15}],9:[function(e,t,r){"use strict";function n(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],10:[function(e,t,r){"use strict";function n(e){var t=e&&e.navigator,r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(r(e))})}}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=n},{}],11:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){"object"===(void 0===e?"undefined":h(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function a(e){var t=y.detectBrowser(e);if("object"===(void 0===e?"undefined":h(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=i({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]}),t.version<68){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],i=e[1],a=e[2];return o.apply(this,[r||null]).then(function(e){if(t.version<53&&!i)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,a)}}}function s(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function c(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r}),y.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function d(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;y.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})})}function p(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function u(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach(function(e){if("rid"in e){var t=/^[a-z0-9]{0,16}$/i;if(!t.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();"encodings"in o||(o.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).catch(function(){})))}return n})}}function l(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}}function f(e){if("object"===(void 0===e?"undefined":h(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return m.shimGetUserMedia}});var v=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return v.shimGetDisplayMedia}}),r.shimOnTrack=o,r.shimPeerConnection=a,r.shimSenderGetStats=s,r.shimReceiverGetStats=c,r.shimRemoveStream=d,r.shimRTCDataChannel=p,r.shimAddTransceiver=u,r.shimCreateOffer=l,r.shimCreateAnswer=f;var g=e("../utils"),y=n(g)},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";function n(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=n},{}],13:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){var t=s.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){s.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":o(e))&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},n&&n.prototype.getSettings){var c=n.prototype.getSettings;n.prototype.getSettings=function(){var e=c.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var d=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":o(e))&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=i;var a=e("../utils"),s=n(a)},{"../utils":15}],14:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e){if("object"===(void 0===e?"undefined":l(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(n){return t.call(r,n,e)}),e.getVideoTracks().forEach(function(n){return t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){var r=arguments[1];return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})}}function o(e){if("object"===(void 0===e?"undefined":l(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}}function a(e){if("object"===(void 0===e?"undefined":l(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}}function s(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(c(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function c(e){return e&&void 0!==e.video?Object.assign({},e,{video:h.compactObject(e.video)}):e}function d(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(h.deprecated("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function p(e){"object"===(void 0===e?"undefined":l(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function u(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}Object.defineProperty(r,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=i,r.shimRemoteStreamsAPI=o,r.shimCallbacksAPI=a,r.shimGetUserMedia=s,r.shimConstraints=c,r.shimRTCIceServerUrls=d,r.shimTrackEventTransceiver=p,r.shimCreateOfferLegacy=u;var f=e("../utils"),h=n(f)},{"../utils":15}],15:[function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function o(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function a(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":m(e))+". Please use a boolean."):(v=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function s(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":m(e))+". Please use a boolean."):(g=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function c(){if("object"===("undefined"==typeof window?"undefined":m(window))){if(v)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function d(e,t){g&&console.warn(e+" is deprecated, please use "+t+" instead.")}function p(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=i(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=i(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=i(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=i(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r}function u(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){return u(e)?Object.keys(e).reduce(function(t,r){var i=u(e[r]),o=i?l(e[r]):e[r],a=i&&!Object.keys(o).length;return void 0===o||a?t:Object.assign(t,n({},r,o))},{}):e}function f(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?f(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){f(e,e.get(t),r)})}))}function h(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&f(e,r,i)})}),i}Object.defineProperty(r,"__esModule",{value:!0});var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=i,r.wrapPeerConnectionEvent=o,r.disableLog=a,r.disableWarnings=s,r.log=c,r.deprecated=d,r.detectBrowser=p,r.compactObject=l,r.walkStats=f,r.filterStats=h;var v=!0,g=!0},{}],16:[function(e,t,r){"use strict";function n(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function i(e,t,r,n,i){var o=p.writeRtpDescription(e.kind,t);if(o+=p.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=p.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(n?n.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+"\r\n"),o}function o(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){var n=0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!r;return n?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}function a(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),a=n(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(n.name.toLowerCase()===a.name.toLowerCase()&&n.clockRate===a.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&a.parameters.apt&&!i(n,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(n.numChannels,a.numChannels),r.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function c(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function d(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var p=e("sdp");t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function l(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var f=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=o(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=p.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(f.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(f.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),f.prototype.onicecandidate=null,f.prototype.onaddstream=null,f.prototype.ontrack=null,f.prototype.onremovestream=null,f.prototype.onsignalingstatechange=null,f.prototype.oniceconnectionstatechange=null,f.prototype.onconnectionstatechange=null,f.prototype.onicegatheringstatechange=null,f.prototype.onnegotiationneeded=null,f.prototype.ondatachannel=null,f.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},f.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},f.prototype.getConfiguration=function(){return this._config},f.prototype.getLocalStreams=function(){return this.localStreams},f.prototype.getRemoteStreams=function(){return this.remoteStreams},f.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},f.prototype.addTrack=function(t,r){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n,i=this.transceivers.find(function(e){return e.track===t});if(i)throw d("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(n=this.transceivers[o]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},f.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},f.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw d("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null;var i=this.transceivers.map(function(e){return e.stream});-1===i.indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},f.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},f.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},f.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},f.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},f.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents
;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var c=p.writeCandidate(a);o.candidate=Object.assign(o.candidate,p.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=p.getMediaSections(n._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",n._localDescription.sdp=p.getDescription(n._localDescription.sdp)+d.join("");var u=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),s||n._dispatchEvent("icecandidate",o),u&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},f.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},f.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},f.prototype._transceive=function(e,r,n){var i=a(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:p.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},f.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(d("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(d("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=p.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=p.parseRtpParameters(e);n.transceivers[t].localCapabilities=r}),n.transceivers.forEach(function(e,t){n._gather(e.mid,t)});else if("answer"===e.type){t=p.splitSections(n._remoteDescription.sdp),r=t.shift();var i=p.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var o=n.transceivers[t],s=o.iceGatherer,c=o.iceTransport,d=o.dtlsTransport,u=o.localCapabilities,l=o.remoteCapabilities,f=p.isRejected(e)&&0===p.matchPrefix(e,"a=bundle-only").length;if(!f&&!o.rejected){var h=p.getIceParameters(e,r),m=p.getDtlsParameters(e,r);i&&(m.role="server"),n.usingBundle&&0!==t||(n._gather(o.mid,t),"new"===c.state&&c.start(s,h,i?"controlling":"controlled"),"new"===d.state&&d.start(m));var v=a(u,l);n._transceive(o,v.codecs.length>0,!1)}})}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},f.prototype.setRemoteDescription=function(n){var i=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(d("TypeError",'Unsupported type "'+n.type+'"'));if(!s("setRemoteDescription",n.type,i.signalingState)||i._isClosed)return Promise.reject(d("InvalidStateError","Can not set remote "+n.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var f=[],h=p.splitSections(n.sdp),m=h.shift(),v=p.matchPrefix(m,"a=ice-lite").length>0,g=p.matchPrefix(m,"a=group:BUNDLE ").length>0;i.usingBundle=g;var y=p.matchPrefix(m,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,h.forEach(function(s,d){var l=p.splitLines(s),h=p.getKind(s),y=p.isRejected(s)&&0===p.matchPrefix(s,"a=bundle-only").length,C=l[0].substr(2).split(" ")[2],b=p.getDirection(s,m),S=p.parseMsid(s),w=p.getMid(s)||p.generateIdentifier();if(y||"application"===h&&("DTLS/SCTP"===C||"UDP/DTLS/SCTP"===C))i.transceivers[d]={mid:w,kind:h,protocol:C,rejected:!0};else{var k,T,R,P,E,x,M,_,A;!y&&i.transceivers[d]&&i.transceivers[d].rejected&&(i.transceivers[d]=i._createTransceiver(h,!0));var O,D,I=p.parseRtpParameters(s);y||(O=p.getIceParameters(s,m),D=p.getDtlsParameters(s,m),D.role="client"),M=p.parseRtpEncodingParameters(s);var B=p.parseRtcpParameters(s),F=p.matchPrefix(s,"a=end-of-candidates",m).length>0,L=p.matchPrefix(s,"a=candidate:").map(function(e){return p.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!y&&g&&d>0&&i.transceivers[d]&&(i._disposeIceAndDtlsTransports(d),i.transceivers[d].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[d].iceTransport=i.transceivers[0].iceTransport,i.transceivers[d].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[d].rtpSender&&i.transceivers[d].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[d].rtpReceiver&&i.transceivers[d].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==n.type||y){if("answer"===n.type&&!y){k=i.transceivers[d],T=k.iceGatherer,R=k.iceTransport,P=k.dtlsTransport,E=k.rtpReceiver,x=k.sendEncodingParameters,_=k.localCapabilities,i.transceivers[d].recvEncodingParameters=M,i.transceivers[d].remoteCapabilities=I,i.transceivers[d].rtcpParameters=B,L.length&&"new"===R.state&&(!v&&!F||g&&0!==d?L.forEach(function(e){c(k.iceTransport,e)}):R.setRemoteCandidates(L)),g&&0!==d||("new"===R.state&&R.start(T,O,"controlling"),"new"===P.state&&P.start(D));var j=a(k.localCapabilities,k.remoteCapabilities),N=j.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!N&&k.sendEncodingParameters[0].rtx&&delete k.sendEncodingParameters[0].rtx,i._transceive(k,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!E||"sendrecv"!==b&&"sendonly"!==b?delete k.rtpReceiver:(A=E.track,S?(o[S.stream]||(o[S.stream]=new e.MediaStream),r(A,o[S.stream]),f.push([A,E,o[S.stream]])):(o.default||(o.default=new e.MediaStream),r(A,o.default),f.push([A,E,o.default])))}}else{k=i.transceivers[d]||i._createTransceiver(h),k.mid=w,k.iceGatherer||(k.iceGatherer=i._createIceGatherer(d,g)),L.length&&"new"===k.iceTransport.state&&(!F||g&&0!==d?L.forEach(function(e){c(k.iceTransport,e)}):k.iceTransport.setRemoteCandidates(L)),_=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(_.codecs=_.codecs.filter(function(e){return"rtx"!==e.name})),x=k.sendEncodingParameters||[{ssrc:1001*(2*d+2)}];var U,H=!1;"sendrecv"===b||"sendonly"===b?(H=!k.rtpReceiver,E=k.rtpReceiver||new e.RTCRtpReceiver(k.dtlsTransport,h),H&&(A=E.track,S&&"-"===S.stream||(S?(o[S.stream]||(o[S.stream]=new e.MediaStream,Object.defineProperty(o[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(A,"id",{get:function(){return S.track}}),U=o[S.stream]):(o.default||(o.default=new e.MediaStream),U=o.default)),U&&(r(A,U),k.associatedRemoteMediaStreams.push(U)),f.push([A,E,U]))):k.rtpReceiver&&k.rtpReceiver.track&&(k.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===k.rtpReceiver.track.id});t&&u(t,e)}),k.associatedRemoteMediaStreams=[]),k.localCapabilities=_,k.remoteCapabilities=I,k.rtpReceiver=E,k.rtcpParameters=B,k.sendEncodingParameters=x,k.recvEncodingParameters=M,i._transceive(i.transceivers[d],!1,H)}}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===n.type?"active":"passive"),i._remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var r=o[t];if(r.getTracks().length){if(-1===i.remoteStreams.indexOf(r)){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i._dispatchEvent("addstream",n)})}f.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&l(i,t,n,[r])})}}),f.forEach(function(e){e[2]||l(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},f.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},f.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},f.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},f.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},f.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},f.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(d("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?(n--,n<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});n>0||o>0;)n>0&&(r._createTransceiver("audio"),n--),o>0&&(r._createTransceiver("video"),o--);var s=p.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(n,i){var o=n.track,a=n.kind,s=n.mid||p.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){var t=n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[];t.forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=c,n.sendEncodingParameters=d}),"max-compat"!==r._config.bundlePolicy&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){s+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+p.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(c)},f.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(d("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=p.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var o=p.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,s){if(!(s+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?n+="m=application 0 DTLS/SCTP 5000\r\n":n+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=a(e.localCapabilities,e.remoteCapabilities),p=d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!p&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=i(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(s)},f.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(n,i){if(!r._remoteDescription)return i(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<r.transceivers.length;a++)if(r.transceivers[a].mid===e.sdpMid){o=a;break}var s=r.transceivers[o];if(!s)return i(d("OperationError","Can not add ICE candidate"));if(s.rejected)return n();var u=Object.keys(e.candidate).length>0?p.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return n();if(u.component&&1!==u.component)return n();if((0===o||o>0&&s.iceTransport!==r.transceivers[0].iceTransport)&&!c(s.iceTransport,u))return i(d("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),t=p.getMediaSections(r._remoteDescription.sdp),t[o]+="a="+(u.type?l:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=p.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),t=p.getMediaSections(r._remoteDescription.sdp),t[f]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=p.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);n()})},f.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw d("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};var h=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];h.forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var i=r.prototype.getStats;r.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){e[r].type=n(e[r]),t.set(r,e[r])}),t})}}});var m=["createOffer","createAnswer"];return m.forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),m=["setLocalDescription","setRemoteDescription","addIceCandidate"],m.forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),f}},{sdp:17}],17:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t=n[i].trim().split("="),r[t[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){var r=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var i={usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e),i=r[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=n.parseRtpMap(s),d=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?n.parseFmtp(d[0]):{},c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.substr(17).split(" ");return t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var p=n.matchPrefix(e,"b=");return p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?1e3*parseInt(p[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=p})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.parseSctpDescription=function(e){var t,r=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=n.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var a=n.matchPrefix(e,"a=sctpmap:");if(a.length>0){var s=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i,o=void 0!==t?t:2;i=e||n.generateSessionId();var a=r||"thisisadapterortc";return"v=0\r\no="+a+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){var t=n.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),r=t[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0],r=t.substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}]},{},[1])(1)}),function(e,t){"function"==typeof define&&define.amd?define(["./adapter"],t):"object"==typeof exports?module.exports=t(require("./adapter")):e.webRtcPlayer=t(e.adapter)}(this,function(e){function t(e){function t(e){n&&console.log(`${Math.floor(Date.now()-i)}: `+e)}e=e||{};var r=this;this.cfg=e.peerConnectionOptions||{},this.cfg.sdpSemantics="unified-plan",this.pcClient=null,this.dcClient=null,this.sdpConstraints={offerToReceiveAudio:1,offerToReceiveVideo:1},this.constraints={audio:!0,video:!1},this.dataChannelOptions={ordered:!0};let n=!1,i=Date.now();createWebRtcVideo=function(){var e=document.createElement("video");return e.id="streamingVideo",e.setAttribute("playsInline",""),e.setAttribute("autoplay",""),e.muted=!0,e.addEventListener("loadedmetadata",function(e){r.onVideoInitialised&&r.onVideoInitialised()},!0),e.addEventListener("pause",function(e){r.onVideoPaused&&r.onVideoPaused()},!0),e},createWebRtcAudio=function(){var e=document.createElement("audio");return e.cotrols=!0,e.id="streamingAudio",e},this.voiceControlButton=null,this.createVoiceControlButton=function(){var e=document.createElement("button"),t=document.createTextNode("关闭声音");e.id="voiceControl",e.appendChild(t),e.addEventListener("click",function(e){ControlAudioVoice()},!0),document.getElementById("recorded").appendChild(e),r.voiceControlButton=e},this.video=createWebRtcVideo(),onsignalingstatechange=function(e){t("signaling state change:",e)},oniceconnectionstatechange=function(e){t("ice connection state change:",e)},onicegatheringstatechange=function(e){t("ice gathering state change:",e)},handleOnTrack=function(e){t("handleOnTrack",e.streams),r.video.srcObject!==e.streams[0]&&(t("setting video stream from ontrack"),r.video.srcObject=e.streams[0],r.video.srcObject.onaddtrack=function(e){t("new track added")})},setupDataChannel=function(e,n,i){try{var o=e.createDataChannel(n,i);return t(`Created datachannel (${n})`),o.onopen=function(e){t(`data channel (${n}) connect`),r.onDataChannelConnected&&r.onDataChannelConnected()},o.onclose=function(e){t(`data channel (${n}) closed`)},o.onmessage=function(e){t(`Got message (${n})`,e.data),r.onDataChannelMessage&&r.onDataChannelMessage(e.data)},o}catch(e){return t("No data channel",e),null}},onicecandidate=function(e){t("ICE candidate",e),e.candidate&&r.onWebRtcCandidate(JSON.stringify(e.candidate))},handleCreateOffer=function(e){
e.createOffer(r.sdpConstraints).then(function(t){e.setLocalDescription(t),r.onWebRtcOffer&&(t.sdp=t.sdp.replace(/(a=fmtp:\d+ .*level-asymmetry-allowed=.*)\r\n/gm,"$1;x-google-start-bitrate=20000;x-google-max-bitrate=100000\r\n"),r.onWebRtcOffer(JSON.stringify(t)))},function(){t("Couldn't create offer")})},setupPeerConnection=function(e){e.SetBitrate&&t("Hurray! there's RTCPeerConnection.SetBitrate function"),e.onsignalingstatechange=onsignalingstatechange,e.oniceconnectionstatechange=oniceconnectionstatechange,e.onicegatheringstatechange=onicegatheringstatechange,e.ontrack=handleOnTrack,e.onicecandidate=onicecandidate},generateAggregatedStatsFunction=function(){return r.aggregatedStats||(r.aggregatedStats={}),function(e){let t={};e.forEach(e=>{"inbound-rtp"!=e.type||e.isRemote||"video"!=e.mediaType&&!e.id.toLowerCase().includes("video")||(t.timestamp=e.timestamp,t.bytesReceived=e.bytesReceived,t.framesDecoded=e.framesDecoded,t.packetsLost=e.packetsLost,t.bytesReceivedStart=r.aggregatedStats&&r.aggregatedStats.bytesReceivedStart?r.aggregatedStats.bytesReceivedStart:e.bytesReceived,t.framesDecodedStart=r.aggregatedStats&&r.aggregatedStats.framesDecodedStart?r.aggregatedStats.framesDecodedStart:e.framesDecoded,t.timestampStart=r.aggregatedStats&&r.aggregatedStats.timestampStart?r.aggregatedStats.timestampStart:e.timestamp,r.aggregatedStats&&r.aggregatedStats.timestamp&&(r.aggregatedStats.bytesReceived&&(t.bitrate=8*(t.bytesReceived-r.aggregatedStats.bytesReceived)/(t.timestamp-r.aggregatedStats.timestamp),t.bitrate=Math.floor(t.bitrate),t.lowBitrate=r.aggregatedStats.lowBitrate&&r.aggregatedStats.lowBitrate<t.bitrate?r.aggregatedStats.lowBitrate:t.bitrate,t.highBitrate=r.aggregatedStats.highBitrate&&r.aggregatedStats.highBitrate>t.bitrate?r.aggregatedStats.highBitrate:t.bitrate),r.aggregatedStats.bytesReceivedStart&&(t.avgBitrate=8*(t.bytesReceived-r.aggregatedStats.bytesReceivedStart)/(t.timestamp-r.aggregatedStats.timestampStart),t.avgBitrate=Math.floor(t.avgBitrate)),r.aggregatedStats.framesDecoded&&(t.framerate=(t.framesDecoded-r.aggregatedStats.framesDecoded)/((t.timestamp-r.aggregatedStats.timestamp)/1e3),t.framerate=Math.floor(t.framerate),t.lowFramerate=r.aggregatedStats.lowFramerate&&r.aggregatedStats.lowFramerate<t.framerate?r.aggregatedStats.lowFramerate:t.framerate,t.highFramerate=r.aggregatedStats.highFramerate&&r.aggregatedStats.highFramerate>t.framerate?r.aggregatedStats.highFramerate:t.framerate),r.aggregatedStats.framesDecodedStart&&(t.avgframerate=(t.framesDecoded-r.aggregatedStats.framesDecodedStart)/((t.timestamp-r.aggregatedStats.timestampStart)/1e3),t.avgframerate=Math.floor(t.avgframerate)))),"track"==e.type&&"video_label"==e.trackIdentifier&&(t.framesDropped=e.framesDropped,t.framesReceived=e.framesReceived,t.framesDroppedPercentage=e.framesDropped/e.framesReceived*100,t.frameHeight=e.frameHeight,t.frameWidth=e.frameWidth,t.frameHeightStart=r.aggregatedStats&&r.aggregatedStats.frameHeightStart?r.aggregatedStats.frameHeightStart:e.frameHeight,t.frameWidthStart=r.aggregatedStats&&r.aggregatedStats.frameWidthStart?r.aggregatedStats.frameWidthStart:e.frameWidth),"candidate-pair"==e.type&&e.hasOwnProperty("currentRoundTripTime")&&(t.currentRoundTripTime=e.currentRoundTripTime)}),r.aggregatedStats=t,r.onAggregatedStats&&r.onAggregatedStats(t)}},this.handleCandidateFromServer=function(e){t("ICE candidate: ",e);let n=new RTCIceCandidate(e);r.pcClient.addIceCandidate(n).then(e=>{t("ICE candidate successfully added")})},this.createOffer=function(){r.pcClient&&(t("Closing existing PeerConnection"),r.pcClient.close(),r.pcClient=null),r.pcClient=new RTCPeerConnection(r.cfg),setupPeerConnection(r.pcClient),r.dcClient=setupDataChannel(r.pcClient,"cirrus",r.dataChannelOptions),handleCreateOffer(r.pcClient)},this.receiveAnswer=function(e){t("Received answer",e);var n=new RTCSessionDescription(e);r.pcClient.setRemoteDescription(n)},this.close=function(){r.pcClient&&(t("Closing existing peerClient"),r.pcClient.close(),r.pcClient=null),r.aggregateStatsIntervalId&&clearInterval(r.aggregateStatsIntervalId)},this.send=function(e){r.dcClient&&"open"==r.dcClient.readyState&&r.dcClient.send(e)},this.getStats=function(e){r.pcClient&&e&&r.pcClient.getStats(null).then(t=>{e(t)})},this.aggregateStats=function(e){let t=generateAggregatedStatsFunction(),n=()=>{r.getStats(t)};r.aggregateStatsIntervalId=setInterval(n,e)}}return t}),function(e,t){"function"==typeof define&&define.amd?define(["./socket.io","./webRtcPlayer"],t):"object"==typeof module&&module.exports?module.exports=t(require("./socket.io"),require("./webRtcPlayer")):e.cloudRenderer=t(window.io,window.webRtcPlayer)}(this,function(e,t){"use strict";function r(r,n,i){function o(){window.addEventListener("resize",k,!0),window.addEventListener("orientationchange",R),window.addEventListener("fullscreenchange",function(e){k()}),window.addEventListener("mozfullscreenchange",function(e){k()}),window.addEventListener("MSFullscreenChange",function(e){k()}),window.addEventListener("webkitfullscreenchange",function(e){k()});let e=document.getElementById("enlarge-display-to-fill-window-tgl");null!=e&&(e.onchange=function(e){k()}),Q=document.getElementById("quality-control-ownership-tgl"),null!=Q&&(Q.onchange=function(e){M()});let t=document.getElementById("prioritise-quality-tgl"),r=document.getElementById("quality-params-submit");null!=t&&(t.onchange=function(e){if(t.checked){let e=document.getElementById("low-bitrate-text").value,t=document.getElementById("high-bitrate-text").value,n=document.getElementById("min-fps-text").value,i={PrioritiseQuality:1,LowBitrate:e,HighBitrate:t,MinFPS:n};c(i),a(i),r.onclick=function(e){let t=document.getElementById("low-bitrate-text").value,r=document.getElementById("high-bitrate-text").value,n=document.getElementById("min-fps-text").value,i={PrioritiseQuality:1,LowBitrate:t,HighBitrate:r,MinFPS:n};c(i),a(i)}}else{let e={PrioritiseQuality:0};c(e),a(e),r.onclick=null}});let n=document.getElementById("show-fps-tgl");null!=n&&(n.onchange=function(e){let t={Console:"stat fps"};E(t)});let i=document.getElementById("match-viewport-res-tgl");null!=i&&(i.onchange=function(e){Z=i.checked});let o=document.getElementById("show-stats-tgl");null!=o&&(o.onchange=function(e){let t=document.getElementById("statsContainer");t.style.display=e.target.checked?"block":"none"});let s=document.getElementById("go-home-button");s&&(s.onclick=function(e){window.history.go(-1)});let d=document.getElementById("kick-other-players-button");d&&(d.onclick=function(e){ge.emit("kick",{})})}function a(e){pe&&console.log("%c"+(new Date).toLocaleTimeString("chinese",{hour12:!1}),"padding:3px 6px 2px;background:#3190e8;border-radius:2px;color:#fff;",e)}function s(){me&&(ve||(ue.video.muted=!1,ve=!0))}function c(e){if(null!=e.PrioritiseQuality){let t="Streamer.PrioritiseQuality "+e.PrioritiseQuality,r={Console:t};E(r)}if(null!=e.LowBitrate){let t="Streamer.LowBitrate "+e.LowBitrate,r={Console:t};E(r)}if(null!=e.HighBitrate){let t="Streamer.HighBitrate "+e.HighBitrate,r={Console:t};E(r)}if(null!=e.MinFPS){let t="Streamer.MinFPS "+e.MinFPS,r={Console:t};E(r)}}function d(e,t,r){let n=document.getElementById("videoPlayOverlay");if(!n){let e=document.getElementById(ye);n=document.createElement("div"),n.id="videoPlayOverlay",e.appendChild(n)}for(;n.lastChild;)n.removeChild(n.lastChild);t&&n.appendChild(t),r&&n.addEventListener("click",function e(t){r(t),n.removeEventListener("click",e)});let i=n.classList;for(let e=i.length-1;e>=0;e--)i.remove(i[e]);n.classList.add(e)}function p(){let e=document.createElement("div");e.id="playButton",e.innerHTML="Click to start",d("clickableState",e,e=>{W()})}function u(e){let t=document.createElement("div");t.id="messageOverlay",t.innerHTML=e||"",d("textDisplayState",t)}function l(){if(h(),ue){let e=ue.video.play();e.then(()=>{me=!0}).catch(e=>{f(),me=!1})}}function f(){let e;document.getElementById("playButton")||(e=document.createElement("div"),e.id="playButton",e.innerHTML="Click to start",d("clickableState",e,e=>{l(),ue.video.muted=!1,e.preventDefault()}))}function h(){d("hiddenState")}function m(){ue?(a("Creating offer"),de.SuperAPI_onRenderCloudConnected&&de.SuperAPI_onRenderCloudConnected(),u("Allocating resources, Please wait..."),ue.createOffer()):(a("WebRTC player not setup, cannot create offer"),u("Unable to setup video"))}function v(e){ue&&ue.send(e)}function g(e,t){be.set(e,t)}function y(e,r){return ue=new t({peerConnectionOptions:r.peerConnectionOptions}),ue.dataChannelConnected=!1,e.appendChild(ue.video),ue.onWebRtcOffer=function(e){ge.emit("webrtc-offer",e)},ue.onWebRtcCandidate=function(e){ge.emit("webrtc-ice",e)},ue.onVideoInitialised=function(){null!=i&&(clearInterval(te),1e3*i<2147483647&&(re=setTimeout(function(){u('Cloud rendering will close after <span style="color:red;font-weight:bold;"> 5 </span> seconds')},1e3*(i-Se)),ne=setTimeout(function(){u("Thank you for your experience!"),ge.close()},1e3*i))),l(),k()},ue.onVideoPaused=function(){ge&&(ge.close(),ge=void 0,he=!1)},ue.onDataChannelConnected=function(){u("Establishing secure connection..."),ue.dataChannelConnected=!0},ue.onDataChannelMessage=function(e){let t=new Uint8Array(e);if(t[0]==xe.QualityControlOwnership){let e=0!=t[1];null!=Q&&(Q.disabled=e,Q.checked=e)}else if(t[0]==xe.Response){let t=new TextDecoder("utf-16").decode(e.slice(1));for(let e of be.values())e(t)}},ge.on("webrtc-answer",function(e){ue.receiveAnswer(e);let t=3e5,r=t;ue.onAggregatedStats=(e=>{let n=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0}),i=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0,minimumIntegerDigits:2}),o="",s=(e.timestamp-e.timestampStart)/1e3,c=[],d=[60,60];for(let e=0;e<d.length;e++)c.push(s%d[e]),s/=d[e];c.push(s);let p=c[0],u=Math.floor(c[1]),l=Math.floor([c[2]]),f="B",h=e.hasOwnProperty("bytesReceived")?e.bytesReceived:0,m=["kB","MB","GB"];for(let e=0;e<m.length&&!(h<1e5);e++)h/=1e3,f=m[e];o+=`Duration: ${i.format(l)}:${i.format(u)}:${i.format(p)}</br>`,o+=`Video Resolution: ${e.hasOwnProperty("frameWidth")&&e.frameWidth&&e.hasOwnProperty("frameHeight")&&e.frameHeight?e.frameWidth+"x"+e.frameHeight:"N/A"}</br>`,o+=`Received (${f}): ${n.format(h)}</br>`,o+=`Frames Decoded: ${e.hasOwnProperty("framesDecoded")?n.format(e.framesDecoded):"N/A"}</br>`,o+=`Packets Lost: ${e.hasOwnProperty("packetsLost")?n.format(e.packetsLost):"N/A"}</br>`,o+=`Bitrate (kbps): ${e.hasOwnProperty("bitrate")?n.format(e.bitrate):"N/A"}</br>`,o+=`Framerate: ${e.hasOwnProperty("framerate")?n.format(e.framerate):"N/A"}</br>`,o+=`Frames dropped: ${e.hasOwnProperty("framesDropped")?n.format(e.framesDropped):"N/A"}</br>`,o+=`Latency (ms): ${e.hasOwnProperty("currentRoundTripTime")?n.format(1e3*e.currentRoundTripTime):"N/A"}</br>`;let v=document.getElementById("stats");v&&(v.innerHTML=o),le&&e.timestampStart&&e.timestamp-e.timestampStart>r&&(a(JSON.stringify(e)),ge.connected&&ge.emit("webrtc-stats",e),r+=t)}),ue.aggregateStats(1e3)}),ge.on("webrtc-ice",function(e){ue&&ue.handleCandidateFromServer(e)}),L(ue.video),m(),ue.video}function C(){let e,t=navigator.userAgent;return e=t.indexOf("Firefox")>-1?"Mozilla Firefox":t.indexOf("Opera")>-1||t.indexOf("OPR")>-1?"Opera":t.indexOf("Trident")>-1?"Microsoft Internet Explorer":t.indexOf("Edge")>-1?"Microsoft Edge":t.indexOf("Chrome")>-1?"Google Chrome or Chromium":t.indexOf("Safari")>-1?"Apple Safari":"unknown",e}function b(e,t){let r=e.getElementsByTagName("VIDEO"),n=window.innerHeight/window.innerWidth,i=e.clientHeight/e.clientWidth,o=r.videoHeight/r.videoWidth;if(o=t?t.height/t.width:r.videoHeight/r.videoWidth,isNaN(o))ie=window.innerWidth,oe=window.innerHeight,"Apple Safari"==C()&&(oe+=64),ae=0,se=0,e.style="top: "+ae+"px; left: "+se+"px; width: "+ie+"px; height: "+oe+"px; cursor: "+Te+"; "+ce;else if(n<i)ie=Math.floor(window.innerHeight/o),oe=window.innerHeight,"Apple Safari"==C()&&(oe+=64),ae=0,se=Math.floor(.5*(window.innerWidth-ie)),e.style="top: "+ae+"px; left: "+se+"px; width: "+ie+"px; height: "+oe+"px; cursor: "+Te+"; "+ce;else{ie=window.innerWidth,oe=Math.floor(window.innerWidth*o);let t=window.innerHeight;"Apple Safari"==C()&&(t+=64),ae=Math.floor(.5*(t-oe)),se=0,e.style="top: "+ae+"px; left: "+se+"px; width: "+ie+"px; height: "+oe+"px; cursor: "+Te+"; "+ce}}function S(e,t){if(t)ie=t.width,oe=t.height;else{let t=e.getElementsByTagName("VIDEO");ie=t.videoWidth,oe=t.videoHeight}ae=Math.floor(.5*(window.innerHeight-oe)),se=Math.floor(.5*(window.innerWidth-ie)),e.style="top: "+ae+"px; left: "+se+"px; width: "+ie+"px; height: "+oe+"px; cursor: "+Te+"; "+ce}function w(e,t){if(t)ie=t.width,oe=t.height;else{let t=e.getElementsByTagName("VIDEO");ie=t.videoWidth,oe=t.videoHeight}e.style="top: 0px; left: 0px; width: "+ie+"px; height: "+oe+"px; cursor: "+Te+"; "+ce}function k(e,t,r){let n=document.getElementById(ye);if(!n)return;if(!ue)return;!t&&ue.dataChannelConnected&&J();let i=t;if(r&&!e||(i=T(t)),Ae=n.getBoundingClientRect(),_(i),n.classList.contains("fixed-size"))return;let o=document.getElementById("enlarge-display-to-fill-window-tgl"),a=window.innerWidth<n.videoWidth||window.innerHeight<n.videoHeight;null!=o?o.checked||a?b(n):S(n):w(n),de.SuperAPI_onResizedFinished&&de.SuperAPI_onResizedFinished()}function T(e){if(null==e&&!Z)return;let t=(new Date).getTime();if(t-Ce>1e3){let t,r;if(e)t=e.width,r=e.height;else{let e=document.getElementById(ye);if(!e)return;t=e.clientWidth,r=e.clientHeight}let n={Resolution:{Width:t,Height:r}};return x(n),a(n),Ce=(new Date).getTime(),X(t,r),{width:t,height:r}}a("Resizing too often - skipping"),clearTimeout(ee),ee=setTimeout(T,1e3)}function R(e){clearTimeout(_e),_e=setTimeout(function(){k()},500)}function P(e,t){let r=JSON.stringify(t),n=new DataView(new ArrayBuffer(5+2*r.length)),i=0;n.setUint8(i,e),i++,n.setUint32(i,r.length,!0),i+=4;for(let e=0;e<r.length;e++)n.setUint16(i,r.charCodeAt(e),!0),i+=2;v(n.buffer)}function E(e){P(Me.UIInteraction,e)}function x(e){P(Me.Command,e)}function M(){n!=Re.Spectator&&v(new Uint8Array([Me.RequestQualityControl]).buffer)}function _(e){let t=document.getElementById(ye);if(t||e){let r;if(e)r=e.height/e.width;else{let e=t.getElementsByTagName("video");if(!(e.length>0))return;r=e[0].videoHeight/e[0].videoWidth}let n=t.clientHeight/t.clientWidth;if(n>r){fe&&a("Setup Normalize and Quantize for playerAspectRatio > videoAspectRatio");let e=n/r;Oe=((r,n)=>{let i=r/t.clientWidth,o=e*(n/t.clientHeight-.5)+.5;return i<0||i>1||o<0||o>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*i,y:65536*o}}),De=((r,n)=>{let i=r/(.5*t.clientWidth),o=e*n/(.5*t.clientHeight);return{x:32767*i,y:32767*o}})}else{fe&&a("Setup Normalize and Quantize for playerAspectRatio <= videoAspectRatio");let e=r/n;Oe=((r,n)=>{let i=e*(r/t.clientWidth-.5)+.5,o=n/t.clientHeight;return i<0||i>1||o<0||o>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*i,y:65536*o}}),De=((r,n)=>{let i=e*r/(.5*t.clientWidth),o=n/(.5*t.clientHeight);return{x:32767*i,y:32767*o}})}}}function A(e,t,r,n){fe&&a(`x: ${e}, y:${t}, dX: ${r}, dY: ${n}`);let i=Oe(e,t),o=De(r,n),s=new DataView(new ArrayBuffer(9));s.setUint8(0,Me.MouseMove),s.setUint16(1,i.x,!0),s.setUint16(3,i.y,!0),s.setInt16(5,o.x,!0),s.setInt16(7,o.y,!0),v(s.buffer)}function O(e,t,r){fe&&a(`mouse button ${e} down at (${t}, ${r})`);let n=Oe(t,r),i=new DataView(new ArrayBuffer(6));i.setUint8(0,Me.MouseDown),i.setUint8(1,e),i.setUint16(2,n.x,!0),i.setUint16(4,n.y,!0),v(i.buffer)}function D(e,t,r){fe&&a(`mouse button ${e} up at (${t}, ${r})`);let n=Oe(t,r),i=new DataView(new ArrayBuffer(6));i.setUint8(0,Me.MouseUp),i.setUint8(1,e),i.setUint16(2,n.x,!0),i.setUint16(4,n.y,!0),v(i.buffer)}function I(e,t,r){fe&&a(`mouse wheel with delta ${e} at (${t}, ${r})`);let n=Oe(t,r),i=new DataView(new ArrayBuffer(7));i.setUint8(0,Me.MouseWheel),i.setInt16(1,e,!0),i.setUint16(3,n.x,!0),i.setUint16(5,n.y,!0),v(i.buffer)}function B(e,t,r){e&Be.PrimaryButton&&D(Ie.MainButton,t,r),e&Be.SecondaryButton&&D(Ie.SecondaryButton,t,r),e&Be.AuxiliaryButton&&D(Ie.AuxiliaryButton,t,r)}function F(e,t,r){e&Be.PrimaryButton&&O(Ie.MainButton,t,r),e&Be.SecondaryButton&&O(Ie.SecondaryButton,t,r),e&Be.AuxiliaryButton&&O(Ie.AuxiliaryButton,t,r)}function L(e){e&&(j(e),H(e),document.getElementById(ye).addEventListener("dblclick",function(e){document.getElementById(ye)}))}function j(e){e.onmouseenter=function(t){fe&&a("mouse enter");let r=new DataView(new ArrayBuffer(1));r.setUint8(0,Me.MouseEnter),v(r.buffer),e.pressMouseButtons(t)},e.onmouseleave=function(t){fe&&a("mouse leave");let r=new DataView(new ArrayBuffer(1));r.setUint8(0,Me.MouseLeave),v(r.buffer),e.releaseMouseButtons(t)}}function N(e){function t(){document.pointerLockElement===e||document.mozPointerLockElement===e?(a("Pointer locked"),document.addEventListener("mousemove",r,!1)):(a("The pointer lock status is now unlocked"),document.removeEventListener("mousemove",r,!1))}function r(e){n+=e.movementX,i+=e.movementY,n>ie&&(n-=ie),i>oe&&(i-=oe),n<0&&(n=ie+n),i<0&&(i=oe-i),A(n,i,e.movementX,e.movementY)}let n=e.width/2,i=e.height/2;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,e.onclick=function(){e.requestPointerLock()},document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),e.onmousedown=function(e){O(e.button,n,i)},e.onmouseup=function(e){D(e.button,n,i)},e.onmousewheel=function(e){I(e.wheelDelta,n,i)},e.pressMouseButtons=function(e){F(e.buttons,n,i)},e.releaseMouseButtons=function(e){B(e.buttons,n,i)}}function U(e){e.onmousemove=function(e){A(e.offsetX,e.offsetY,e.movementX,e.movementY),e.preventDefault()},e.onmousedown=function(e){O(e.button,e.offsetX,e.offsetY),e.preventDefault()},e.onmouseup=function(e){D(e.button,e.offsetX,e.offsetY),s(),e.preventDefault()},e.oncontextmenu=function(e){D(e.button,e.offsetX,e.offsetY)},"onmousewheel"in e?e.onmousewheel=function(e){I(e.wheelDelta,e.offsetX,e.offsetY),e.preventDefault()}:e.addEventListener("DOMMouseScroll",function(e){I(-120*e.detail,e.offsetX,e.offsetY),e.preventDefault()},!1),e.pressMouseButtons=function(e){F(e.buttons,e.offsetX,e.offsetY)},e.releaseMouseButtons=function(e){B(e.buttons,e.offsetX,e.offsetY)}}function H(e){function t(e){let t=i.pop();void 0===t&&a("exhausted touch indentifiers"),o[e.identifier]=t}function r(e){i.push(o[e.identifier]),delete o[e.identifier]}function n(t,r){let n=new DataView(new ArrayBuffer(2+6*r.length));n.setUint8(0,t),n.setUint8(1,r.length);let i=2;for(let t=0;t<r.length;t++){let s=r[t],c=s.clientX-e.offsetLeft,d=s.clientY-e.offsetTop;fe&&a(`F${o[s.identifier]}=(${c}, ${d})`);let p=Oe(c,d);n.setUint16(i,p.x,!0),i+=2,n.setUint16(i,p.y,!0),i+=2,n.setUint8(i,o[s.identifier],!0),i+=1,n.setUint8(i,255*s.force,!0),i+=1}v(n.buffer)}let i=[9,8,7,6,5,4,3,2,1,0],o={};if(Ee.fakeMouseWithTouches){let t=void 0;e.ontouchstart=function(r){if(void 0===t){let n=r.changedTouches[0];t={id:n.identifier,x:n.clientX-Ae.left,y:n.clientY-Ae.top},e.onmouseenter(r),O(Ie.MainButton,t.x,t.y)}r.preventDefault()},e.ontouchend=function(r){for(let n=0;n<r.changedTouches.length;n++){let i=r.changedTouches[n];if(i.identifier===t.id){let n=i.clientX-Ae.left,o=i.clientY-Ae.top;D(Ie.MainButton,n,o),e.onmouseleave(r),t=void 0;break}}s(),r.preventDefault()},e.ontouchmove=function(e){for(let r=0;r<e.touches.length;r++){let n=e.touches[r];if(n.identifier===t.id){let e=n.clientX-Ae.left,r=n.clientY-Ae.top;A(e,r,e-t.x,r-t.y),t.x=e,t.y=r;break}}e.preventDefault()}}else e.ontouchstart=function(e){for(let r=0;r<e.changedTouches.length;r++)t(e.changedTouches[r]);fe&&a("touch start"),n(Me.TouchStart,e.changedTouches),e.preventDefault()},e.ontouchend=function(e){fe&&a("touch end"),n(Me.TouchEnd,e.changedTouches);for(let t=0;t<e.changedTouches.length;t++)r(e.changedTouches[t]);s(),e.preventDefault()},e.ontouchmove=function(e){fe&&a("touch move"),n(Me.TouchMove,e.touches),e.preventDefault()}}function z(e){return e>=112&&e<=123||9==e}function G(){document.onkeydown=function(e){fe&&a(`key down ${e.keyCode}, repeat = ${e.repeat}`),v(new Uint8Array([Me.KeyDown,e.keyCode,e.repeat]).buffer),Ee.suppressBrowserKeys&&z(e.keyCode)&&e.preventDefault()},document.onkeyup=function(e){fe&&a(`key up ${e.keyCode}`),v(new Uint8Array([Me.KeyUp,e.keyCode]).buffer),Ee.suppressBrowserKeys&&z(e.keyCode)&&e.preventDefault()},document.onkeypress=function(e){fe&&a(`key press ${e.charCode}`);let t=new DataView(new ArrayBuffer(3));t.setUint8(0,Me.KeyPress),t.setUint16(1,e.charCode,!0),v(t.buffer)}}function q(){let e=document.getElementById("stats");e&&(e.innerHTML="Not connected"),!connect_on_load||he?(p(),k()):W()}function W(){if(!de.rendererio)return void(de.SuperAPI_onUnavailableRender&&de.SuperAPI_onUnavailableRender());let t=void 0;ge=e(de.rendererio),ge.on("clientConfig",function(e){t=e,Y(e)}),ge.on("message",function(e){a(`unrecognised message ${e.byteLength}: ${e.slice(0,50).toString("hex")}`)}),ge.on("clientCount",function(e){let t=document.getElementById("kick-other-players-button");t&&(t.value=`Kick (${e.count})`)}),ge.on("connect",()=>{V(),$()}),ge.on("error",e=>{de.SuperAPI_onRenderCloudError&&de.SuperAPI_onRenderCloudError()}),ge.on("streamingOver",()=>{me=!1;let e=document.getElementById(ye);ue&&(e.removeChild(webEstablishingRtcPlayerObj.video),ue.close(),ue=void 0),setTimeout(q,5e3)}),ge.on("disconnect",e=>{a(`Connection is closed: ${e}`),ge.close(),ge=void 0,me=!1,clearTimeout(we),clearTimeout(ke),de.SuperAPI_onStopedRenderCloud&&de.SuperAPI_onStopedRenderCloud()}),ge.on("audienceTimeout",()=>{de.SuperAPI_onSpectatorTimeout&&de.SuperAPI_onSpectatorTimeout()}),ge.on("spectatorConnected",()=>{de.SuperAPI_onSpectatorConnected&&de.SuperAPI_onSpectatorConnected()}),ge.on("spectatorDisconnected",()=>{de.SuperAPI_onSpectatorDisconnected&&de.SuperAPI_onSpectatorDisconnected()}),ge.on("resize",(e,t)=>{a(`Resizing video to ${e}x${t}`);let r={width:e,height:t};k(void 0,r,!1)}),ge.on("resized",(e,t)=>{a(`Video has resized to ${e}x${t}`);let r={width:e,height:t};k(void 0,r,!0)})}function V(){null!=ge&&ge.emit("playerType",n)}function $(){let e={emitData:"ArrayBuffer"},t=JSON.stringify(e);ge.emit("userConfig",t)}function J(){if(null==ge)return;let e=window.devicePixelRatio*window.innerWidth,t=window.devicePixelRatio*window.innerHeight;ge.emit("windowSize",e,t)}function X(e,t){null!=ge&&ge.emit("resized",e,t)}function Y(e){let t=document.getElementById(ye),r=y(t,e);switch(k(),Ee.controlScheme){case Pe.HoveringMouse:U(r);break;case Pe.LockedMouse:N(r);break;default:a(`ERROR: Unknown control scheme ${Ee.controlScheme}`),N(r)}}function K(e,t){let r={command:"event",func_name:e,args:t};a("send a command to render cloud: command data = "+JSON.stringify(r)),E(r)}let Q,Z,ee,te,re,ne,ie,oe,ae,se,ce,de=this,pe=!1,ue=null,le=!1,fe=!1,he=!0,me=!1,ve=!1,ge=null,ye=r,Ce=(new Date).getTime(),be=new Map,Se=(Date.now(),(navigator.language||navigator.browserLanguage).substring(0,2).toLowerCase(),5),we=null,ke=null,Te="default";const Re={Solo:0,Spectator:1,Presenter:2,Controller:3};this.PlayerType=Re,null==n&&(n=Re.Solo);const Pe={LockedMouse:0,HoveringMouse:1},Ee={controlScheme:Pe.HoveringMouse,suppressBrowserKeys:!0,fakeMouseWithTouches:!1},xe={QualityControlOwnership:0,Response:1},Me={IFrameRequest:0,RequestQualityControl:1,MaxFpsRequest:2,AverageBitrateRequest:3,StartStreaming:4,StopStreaming:5,UIInteraction:50,Command:51,KeyDown:60,KeyUp:61,KeyPress:62,MouseEnter:70,MouseLeave:71,MouseDown:72,MouseUp:73,MouseMove:74,MouseWheel:75,TouchStart:80,TouchEnd:81,TouchMove:82};let _e,Ae=void 0,Oe=void 0,De=void 0;const Ie={MainButton:0,AuxiliaryButton:1,SecondaryButton:2},Be={PrimaryButton:1,SecondaryButton:2,AuxiliaryButton:4};this.SuperAPI_StartRenderCloud=function(e){de.rendererio=e,o(),G(),W()},this.SuperAPI_StopRenderCloud=function(){ge&&ge.disconnect()},this.SuperAPI_StartPresent=function(){n!=Re.Spectator&&null!=ge&&ge.emit("present")},this.SuperAPI_StopPresent=function(){n!=Re.Spectator&&null!=ge&&ge.emit("stopPresent")},this.SuperAPI_SetLogMode=function(e){pe=e},this.SuperAPI=((e,...t)=>{let r=t[0],n=t[1],i=t[2];t[3],t[4];switch(e){case"StartRenderCloud":de.rendererio=r,o(),W();break;case"StopRenderCloud":ge&&ge.disconnect();break;case"RegisterCloudResponse":g("handle_responses",r);break;case"GetCameraInfo":K("getCameraInfo",{coord_type:r,cad_mapkey:n||"default"});break;case"SetCameraInfo":K("setCameraTransfrom",r);break;case"SetCameraRotate":K("aroundCameraRotate",n?{circle_time:r,direction:n}:{circle_time:"0",direction:"0"});break;case"SetCameraMove":K("moveCameraPositons",r);break;case"SetCameraMoveState":K("moveCameraState",{state:r});break;case"SplitBuild":K("splitBuild",r);break;case"CoverSelection":K("startCoversSelection",{selection_type:r});break;case"AddVideoProjection":K("addVideoProjection",r);break;case"ShowVideoProjection":K("showVideoProjection",{id:r,bshow:!0});break;case"HideVideoProjection":K("hideVideoProjection",{id:r,bshow:!1});break;case"RemoveVideoProjection":K("removeVideoProjection",{id:r});break;case"RemoveAllVideoProjection":K("removeAllVideoProjection",{});break;case"AddPOI":K("addNaviPoint",r);break;case"UpdatePOICoord":K("updatePOICoord",r);break;case"UpdatePOIStyle":K("updatePOIStyle",r);break;case"SetPOISelect":K("setPOISelect",{id:r,select:n});break;case"GetPOIScreenRange":K("getPOIScreenRange",{id:r});break;case"ShowPOI":K("showPOI",{id:r});break;case"HidePOI":K("hidePOI",{id:r});break;case"FocusPOI":K("moveNext",{id:r,distance:n});break;case"FocusAllPOI":K("cameraFocusCurrentPOI",{null:""});break;case"RemovePOI":K("removeNaviPoint",{id:r});break;case"RemoveAllPOI":K("clearAllPOI",{});break;case"AddCustomPOI":K("addCustomPOI",r);break;case"UpdateCustomPOICoord":K("updateCustomPOICoord",r);break;case"UpdateCustomPOIStyle":K("updateCustomPOIStyle",r);break;case"UpdateCustomPOIMarker":K("updateCustomPOIMarker",r);break;case"UpdateCustomPOILabel":K("updateCustomPOILabel",r);break;case"UpdateCustomPOIWindow":K("updateCustomPOIWindow",r);break;case"POICluster":K("openStopPOIPolymerization",n?{type:r,open:n}:{type:"",open:"false"});break;case"AddPath":K("createtrackline",r);break;case"UpdatePathCoord":K("updateTrackLineCoord",r);break;case"UpdatePathStyle":K("updateTrackLineStyle",r);break;case"FocusPath":K("cameraFocusTrackLine",{id:r,distance:n});break;case"FocusAllPath":K("cameraFocusAllTrackLine",{null:""});break;case"ShowPath":K("showhidetrackline",{id:r,bshow:!0});break;case"HidePath":K("showhidetrackline",{id:r,bshow:!1});break;case"RemovePath":K("destroytrackline",{id:r});break;case"RemoveAllPath":K("removeAllPath",{null:""});break;case"AddHeatMap":K("createHeatMap",r);break;case"UpdateHeatMap":K("updateHeatMap",r);break;case"UpdateHeatMapStyle":K("updateHeatMapStyle",r);break;case"FocusHeatMap":K("cameraFocusHeatMap",{id:r,distance:n});break;case"FocusAllHeatMap":K("cameraFocusAllHeatMap",{null:""});break;case"ShowHeatMap":K("showHideHeatMap",{id:r,bshow:!0});break;case"HideHeatMap":K("showHideHeatMap",{id:r,bshow:!1});break;case"RemoveHeatMap":K("destroyHeatMap",{id:r});break;case"RemoveAllHeatMap":K("removeAllHeatMap",{null:""});break;case"AddRoadHeatMap":K("createRoadHeatMap",r);break;case"UpdateRoadHeatMap":K("updateRoadHeatMap",r);break;case"UpdateRoadHeatMapCoord":K("updateRoadHeatMapCoord",r);break;case"UpdateRoadHeatMapStyle":K("updateRoadHeatMapStyle",r);break;case"FocusRoadHeatMap":K("cameraFocusRoadHeatMap",{id:r,distance:n});break;case"FocusAllRoadHeatMap":K("cameraFocusAllRoadHeatMap",{null:""});break;case"ShowRoadHeatMap":K("showHideRoadHeatMap",{id:r,bshow:!0});break;case"HideRoadHeatMap":K("showHideRoadHeatMap",{id:r,bshow:!1});break;case"RemoveRoadHeatMap":K("destroyRoadHeatMap",{id:r});break;case"RemoveAllRoadHeatMap":K("removeAllRoadHeatMap",{null:""});break;case"AddMigrationMap":K("addMigrationmap",r);break;case"UpdateMigrationMapCoord":K("updateMigrationMapCoord",r);break;case"UpdateMigrationMapStyle":K("updateMigrationMapStyle",r);break;case"FocusMigrationMap":K("cameraFocusMigrationMap",{id:r,distance:n});break;case"FocusAllMigrationMap":K("camerafocusAllMigrationMap",{null:""});break;case"ShowMigrationMap":K("showHideMigrationMap",{id:r,bshow:!0});break;case"HideMigrationMap":K("showHideMigrationMap",{id:r,bshow:!1});break;case"RemoveMigrationMap":K("removeMigrationMap",{id:r});break;case"RemoveAllMigrationMap":K("removeAllMigrationMap",{null:""});break;case"AddStrategyMap":K("addStrategyMap",r);break;case"PlayStrategyMap":K("playSingleAnimation",{id:r,index:n,forward:i});break;case"UpdateStrategyMapCoord":K("updateStrategyMapCoord",r);break;case"UpdateStrategyMapStyle":K("updateStrategyMapStyle",r);break;case"FocusStrategyMap":K("cameraFocusStrategyMap",{id:r,distance:n});break;case"FocusAllStrategyMap":K("camerafocusAllStrategyMap",{null:""});break;case"ShowStrategyMap":K("showHideStrategyMap",{id:r,bshow:!0});break;case"HideStrategyMap":K("showHideStrategyMap",{id:r,bshow:!1});break;case"RemoveStrategyMap":K("removeStrategyMap",{id:r});break;case"RemoveAllStrategyMap":K("removeAllStrategyMap",{null:""});break;case"AddRange":K("createRange",r);break;case"UpdateRangeCoord":K("updateRangeCoord",r);break;case"UpdateRangeStyle":K("updateRangeStyle",r);break;case"FocusRange":K("cameraFocusRange",{id:r,distance:n});break;case"FocusAllRange":K("cameraFocusAllRange",{null:""});break;case"ShowRange":K("showhiderange",{id:r,bshow:!0});break;case"HideRange":K("showhiderange",{id:r,bshow:!1});break;case"RemoveRange":K("destroyrange",{id:r});break;case"RemoveAllRange":K("removeAllRange",{null:""});break;case"AddCircularRange":K("createCircularRange",r);break;case"UpdateCircularRangeCoord":K("updateCircularRangeCoord",r);break;case"UpdateCircularRangeStyle":K("updateCircularRangeStyle",r);break;case"FocusCircularRange":K("cameraFocusCircularRange",{id:r,distance:n});break;case"FocusAllCircularRange":K("cameraFocusAllCircularRange",{null:""});break;case"ShowCircularRange":K("showhideCircularRange",{id:r,bshow:!0});break;case"HideCircularRange":K("showhideCircularRange",{id:r,bshow:!1});break;case"RemoveCircularRange":K("destroyCircularRange",{id:r});break;case"RemoveAllCircularRange":K("removeAllCircularRange",{null:""});break;case"AddEffect":K("addEffect",r);break;case"FocusEffect":K("cameraFocusEffect",{id:r,distance:n});break;case"UpdateEffectCoord":K("updateSceneEffectCoord",r);break;case"UpdateEffectStyle":K("updateSceneEffectStyle",r);break;case"FocusAllEffect":K("cameraFocusAllEffect",{null:""});break;case"ShowEffect":K("showEffect",{id:r});break;case"HideEffect":K("hideEffect",{id:r});break;case"RemoveEffect":K("removeEffect",{id:r});break;case"RemoveAllEffect":K("removeAllEffect",{null:""});break;case"SetEnvTime":K("setEnvTime",{env_time:r});break;case"SetEnvWeather":K("setEnvWeather",{env_weather:r});break;case"StartMeasureTool":K("startMeasureTool",{coord_type:r,cad_mapkey:n||"default"});break;case"EndMeasureTool":K("endMeasureTool",{null:""});break;case"ClearAll":K("clearAllPOI",{}),K("removeAllPath",{null:""}),K("removeAllHeatMap",{null:""}),K("removeAllRoadHeatMap",{null:""}),K("removeAllMigrationMap",{null:""}),K("removeAllStrategyMap",{null:""}),K("removeAllRange",{null:""}),K("removeAllCircularRange",{null:""}),K("removeAllEffect",{null:""}),K("endMeasureTool",{null:""});break;case"specialChannel":K("specialChannel",r);break;default:console.warn((new Date).toLocaleTimeString("chinese",{hour12:!1})+" ReferenceError: %c"+e,"padding:3px 6px 2px;background:#00bcd4;border-radius:2px;color:#fff;")}})}return r}),console.log("%cSuperAPI Version: 2.8.0","padding:3px 6px 2px;background:#00bcd4;border-radius:2px;color:#fff;"),document.oncontextmenu=new Function("event.returnValue=false;"),
document.getElementsByTagName("head")[0].innerHTML+='<style type="text/css">@charset "UTF-8";#player{position:fixed;left:0;top:0;width:100vw;height:100vh;background:#fff;z-index:10000}#streamingVideo{display:block;position:fixed;left:0;top:0;width:100%;height:100%;z-index:100;object-fit:contain}#videoPlayOverlay{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center;line-height:1.5;font-size:40px;box-sizing:border-box;z-index:200;background:rgba(0,0,0,1)}#videoPlayOverlay.clickableState{background:rgba(0,0,0,.6)}#playButton{display:inline-block;--size:10px;padding:10px 60px 12px;border:2px solid rgba(255,255,255,.2);border-radius:calc(var(--size) * 8.6 / 2);color:#fff;cursor:pointer;background:linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);animation:Gradient-hue 4s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent}#videoPlayOverlay.hiddenState{z-index:10}#videoPlayOverlay.showState{height:100vh;font-size:50px;background:rgba(0,0,0,.75);pointer-events:none;z-index:300;flex-direction:column;vertical-align:50px}#videoPlayOverlay #messageOverlay{color:#fff;background:linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);animation:Gradient-hue 4s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent}#videoPlayOverlay #endTime{display:block;margin-top:20px;font-size:80px;margin-top:-10px;background:linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);animation:Gradient-hue 4s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent}@keyframes Gradient-hue{from{-webkit-filter:hue-rotate(0)}to{-webkit-filter:hue-rotate(-360deg)}}@media all and (max-width:767px){#videoPlayOverlay{font-size:22px;padding:0 20px}#videoPlayOverlay.showState{font-size:22px}}</style>';